<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="/static/styles/upload.css" >
	</head>

	<body>
		<!-- Banner -->
		<div class="chrome banner">
			<a href="/"><h1>OSAI</h1></a>
		</div>

	<div class="contents">
		<table>
			<thead>
				<tr>
					<th> Game</th>
					<th>Language</th>
				</tr>
			</thead>
			<tr>
				<td>
				<select id="game">
					<option>Othello</option>
					<option>Tic Tac Toe</option>
					<option>Asteroids</option>
				</select>
				<select id="lang">
					<option>JavaScript</option>
					<option>Java</option>
					<option>Python</option>
				</select></td>
			</tr>
			<tr>
				<td>
				<button id="uploadButton" class="button">
					Upload
				</button></td>
				<td>
				<button id="newButton" class="button">
					New
				</button></td>
			</tr>

			<!-- File Uploader -->
			<div id="fileUploader" style="display:none;">
				<h3>Source Code Uploader</h3>
				<span>Select the language of the source file and the location of the file.</span>

				<form action="../upload_file" enctype="multipart/form-data" method="post" target="submit_frame">
					<input name="file" type="file" required >
					<br>
					<input type="submit" value="Upload">
				</form>

				<iframe id="submit_frame" name="submit_frame" style="display:none;"></iframe>
			</div>
		</table>
		</div>

		<script type="application/javascript" src="/static/javascript-framework/src/App.js" ></script>

		<script type="application/javascript">
			using('lib', '/static/javascript-framework/src/');
			using('ai', '/static/scripts/');

			var UploadPanel = include('ai.upload.UploadPanel');

			App.onready = function() {
				App.setTitle('Web AI: Upload');

				var uploadButton = document.getElementById('uploadButton');
				var uploadPanel = new UploadPanel();

				uploadButton.on('click', function() {
					uploadPanel.show();
				});

				var newButton = document.getElementById('newButton');
				newButton.on('click', function() {
					sessionStorage.removeItem('src_code');
					gotoEditor();
				});

				var frame = document.getElementById('submit_frame');
				frame.on('load', function() {
					sessionStorage.setItem('src_code', frame.contentDocument.body.firstChild.nodeValue);
					gotoEditor();
				});

				function gotoEditor() {
					var game = document.getElementById('game').value;
					var lang = document.getElementById('lang').value;
					location = '/static/edit.html?game=' + game + '&lang=' + lang;
				}

			};
		</script>
	</body>
</html>
